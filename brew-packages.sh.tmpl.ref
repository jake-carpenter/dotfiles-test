# #!/usr/bin/env bash

# # Hash the packages file to trigger a change here when there's a change there.
# # packages.yaml hash: {{ include ".chezmoidata/packages.yaml" | sha256sum }}

# source $HOME/.zprofile

# # Initialize arrays
# taps=()
# brews=()
# casks=()
# profile=()

# # Base profile
# {{ range .packages.darwin.base.taps }}
#   taps+=({{ . | quote }})
# {{ end }}
# {{ range .packages.darwin.base.brews }}
#   brews+=({{ . | quote }})
# {{ end }}
# {{ range .packages.darwin.base.casks }}
#   casks+=({{ . | quote }})
# {{ end }}

# # Desktop profile
# {{ if has .chezmoi.hostname .systems.desktop }}
#   profile+=(desktop)

#   {{ range .packages.darwin.desktop.taps }}
#     taps+=({{ . | quote }})
#   {{ end -}}
#   {{ range .packages.darwin.desktop.brews }}
#     brews+=({{ . | quote }})
#   {{ end }}
#   {{ range .packages.darwin.desktop.casks }}
#     casks+=({{ . | quote }})
#   {{ end }}
# {{ end }}

# # Personal profile
# {{ if has .chezmoi.hostname .systems.personal }}
#   profile+=(personal)

#   {{ range .packages.darwin.personal.taps }}
#     taps+=({{ . | quote }})
#   {{ end -}}
#   {{ range .packages.darwin.personal.brews }}
#     brews+=({{ . | quote }})
#   {{ end }}
#   {{ range .packages.darwin.personal.casks }}
#     casks+=({{ . | quote }})
#   {{ end }}
# {{ end }}

# # Join profile array with commas for display
# profile_str="base"
# if [[ ${#profile[@]} -gt 0 ]]; then
#   profile_str="base, $(printf "%s, " "${profile[@]}" | sed 's/, $//')"
# fi

# echo -e "\n💡 This system is in the following profiles: \033[32m${profile_str}\033[0m"

# # Formulae
# echo -e '\n🚀 Tapping formulae\n'

# for tap in "${taps[@]}"; do
#   if ! brew tap 2>/dev/null | grep -q "$tap"; then
#     echo "❌ $tap"
#     brew tap "$tap"
#   else
#     echo "✅ $tap"
#   fi
# done

# # Brew packages
# echo -e '\n🚀 Installing base brew packages\n'

# # Build brewfile content from the collected package lists
# brewfile_content=""
# for brew in "${brews[@]}"; do
#   brewfile_content="${brewfile_content}\nbrew \"$brew\""
# done
# for cask in "${casks[@]}"; do
#   brewfile_content="${brewfile_content}\ncask \"$cask\""
# done

# echo -e "$brewfile_content" | brew bundle --file=/dev/stdin
